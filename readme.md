通用测控上位机
======
# 功能  

通过文本行方式对设备进行测控，包括状态上报和指令下达。状态变量和指令都通过配置文件描述，所以上位机可以在各项目间通用。  

上位机实现曲线显示、变量显示、变量有效性显示、指令下达、数据记录等功能  

# 协议  
## 测控设计原则  
基本仪表测控分为状态上报(上行)和指令下达(下行)两部分,数据类型包括：  
1. 块数据：一段非数值数据，例如地图  
	若需要分包发送，则需要包序号和校验保证完整性。若信道指令不好，还需进行确认反馈  
2. 数值型数据  
	一般多个数值型数据打包发送，当带宽足够时，也可单独发送  
3. 开关量数据  
	一般使用位段压缩在几个字节以内，作为一个数值型变量发送  
4. 事件
	一般通过独立包发送，触发发送。  
对于上行数据，可直接发送；对于下行指令，若按数据组织直接发送，则在一个数据组织中的不同变量都作为指令执行，除非单主机完全控制，否则影响指令的灵活性  
对于具有多个控制端，或一些控制变量涉及自动/人工切换时，需要单独控制的下行指令，需要分小包下发，每个包仅容纳一个控制变量。对于开关型数据，可采用mask方式指定一组有效的变量。  
## 测控UI的基本需求  
1. 非控数值型：名称、显示label、刷新标志、记录/曲线标志  
2. 测控数值型：名称、显示label、刷新标志、记录/曲线标志、输入框  
3. 非控开关型：名称、刷新标志  
4. 测控开关型：名称、刷新标志、期望状态  
# 结构  

上位机由C# wpf开发，C#部分使用通用文本测控协议，对状态变量和指令进行描述和交互；使用协议适配器对设备实际协议进行适配。协议适配器为动态库，以cdecl方式调用。  

上位机加载适配器后，将串口数据以流的方式发送给适配器，适配器通过返回标志指示是否提取到了有效数据包，通过全局变量传递结果字符，以通用文本测控协议实现交互。  